# MADock
任意の映像と音声を結合するツール。  
Microsoft Copilot およびChatGPTを使用して作成しています。  

前提条件：ffmpegの導入  
（入手先→ https://ffmpeg.org ）  
テスト環境：Windows11

## 使用方法
- batファイルからスクリプトを起動する  
（初回起動時はffmpeg.exe を指定する案内が表示されます）
- 結合したい映像ファイルと音声ファイルをドラッグ&ドロップする
- ファイルが揃ったら実行ボタンを押すと処理開始  
  - 初期出力先はスクリプトファイル保存場所
  - 映像ファイルのみの時実行すると、映像ファイルから音声ファイルを取り出しを実行


## 対応形式
### 入力ファイル
- **動画ファイル**（拡張子）  
  - `.mp4`, `.mkv`, `.mov`

- **音声ファイル**（拡張子）  
  - `.wav`, `.flac`, `.alac`, `.aac`, `.mp3`, `.m4a`



### 出力ファイル
- **MP4形式**
  - 映像：`h264` / `hevc` のみ対応、無劣化コピー（`-c:v copy`）
  - 音声：`aac` または `alac` に変換  
    - 入力が `aac` / `alac` の場合は無劣化コピー  
    - その他（`wav`, `flac`, `mp3`, `m4a` など）は自動的に再エンコードされる（エラーにはならない）  
    - 24bit / float 音声は `alac` 変換を選択可能（`aac` 変換時は16bitに変換）


- **MKV形式**
  - 映像：`h264`, `hevc`, `vp8`, `vp9`, `mpeg4`, `theora` に対応、無劣化コピー（`-c:v copy`）
  - 音声：`wav`, `flac`, `aac`, `alac`, `mp3`, `opus` に対応、無劣化コピー  

- **MOV形式**
  - 映像：`h264`, `prores`, `mpeg4`, `dvvideo` に対応、無劣化コピー（`-c:v copy`）
  - 音声：`wav`, `aac`, `alac`, `mp3` に対応、無劣化コピー  
    - `flac` は `wav` に変換して処理  


## 更新履歴
■ **ver 0.1**  
- 映像・音声ファイルをドラック＆ドロップで再構成
- 実行ファイルと同じ場所に差し替えたファイルを生成
- 出力ファイルはmp4のみ
- 入力音声はwavのみ
  - 音声はAAC16bitに再エンコード
- ファイルが揃ったら自動実行
- 処理後はファイルパスリセット  

---

■ **ver 0.2**
- mkv出力処理追加
  - 映像・音声ともに無劣化コピーが基本
- ファイルが揃う前にドロップし直した場合、使用ファイルを修正できる
- リセットボタン追加
- 音声形式をwavのみから可逆圧縮形式に対応
- 映像と音声の長さが違っても短い方に合わせない
- 入力ファイル名の表示  

---

■ **ver 0.3**
- 自動実行の廃止（実行ボタンの設置）
- 処理完了後もファイルパスを保持する  
	
---    
	
■ **ver 0.4**
- ffmpegの実行ファイルパスを任意に指定する方式に切り替え（設定ファイルの新設）
- ファイル選択ボタンの設置
- UIの変更
- 設定ウインドウの追加
  - ffmpeg.exe パス設定
  - ファイル選択初期フォルダ設定
  - 出力先フォルダ設定
  - 保存名Suffix有無の切り替え
  - 上書き防止ナンバリング形式選択
- 出力完了後にフォルダを開くオプションの追加  
- 映像と音声の長さが違う場合の分岐オプションを追加
  - 従来通り→長さを調整しない
  - オプション→短い方に合わせる  

---
  
■ **ver 0.5**
- mov出力処理の追加
  - FLACはWAVに変換して格納
  - 音声ファイルが16bit以外の場合は、正常に再生できない可能性あり
- mp4同時出力設定UIの位置を変更
- mp4出力時に入力音声のビットレートに合わせて変換先を選べる処理の追加
  - 16bit以外の時ALAC(24bit)を選択可能

---

■ **ver 0.6**
- スクリプトファイル(MADock_gui.ps1)の分離
  - MADock_gui: メインUI関連 
  - MADock_settings: 設定ウインドウ関連
  - MADock_core: UI共通ロジック
  - MADock_main: 結合処理関連
  - MADock_utils: 映像・音声情報取得関連
- 映像から音声を分離する機能の追加（MADock_sub）  
- 入力ファイル（映像）と同じ場所にファイルを出力するオプションの追加
- 入力ファイル拡張子の追加
  - mkv, mov の追加（それに伴い非対応映像コーデックの処理キャンセル処理を追加）
- 映像と音声を結合する処理部分の再構築
  - 各出力処理ロジックを独立関数化
  - mp4出力時の不要な中継WAV変換の廃止